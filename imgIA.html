<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teachable Machine Image Model</title>
</head>
<body>
    <div>Teachable Machine Image Model</div>
    <input type="file" accept="image/*" onchange="previewImage(event)">
    <button type="button" onclick="predict()">Predict</button>
    <div id="image-container"></div>
    <div id="label-container"></div>
    <div id="prediction-message"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        let model, webcam, maxPredictions;
        const imageContainer = document.getElementById("image-container");
        const labelContainer = document.getElementById("label-container");
        const predictionMessage = document.getElementById('prediction-message');

        async function init() {
            const URL = "https://teachablemachine.withgoogle.com/models/Mc36jaCDE/";
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();
        }

        function previewImage(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function() {
                const img = new Image();
                img.src = reader.result;
                img.onload = function() {
                    imageContainer.innerHTML = '';
                    imageContainer.appendChild(img);
                };
            }

            reader.readAsDataURL(file);
        }

        async function predict() {
            if (!model) {
                await init();
            }

            const image = imageContainer.querySelector('img');
            const prediction = await model.predict(image);
            labelContainer.innerHTML = '';

            let highestPrediction = {className: '', probability: -1};

            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > highestPrediction.probability) {
                    highestPrediction = prediction[i];
                }

                const classPrediction = `${prediction[i].className}: ${prediction[i].probability.toFixed(2)}`;
                const labelElement = document.createElement("div");
                labelElement.textContent = classPrediction;
                labelContainer.appendChild(labelElement);
            }

            predictionMessage.textContent = `La imagen parece ser: ${highestPrediction.className}`;
        }

        window.onload = init;
    </script>
</body>
</html>
